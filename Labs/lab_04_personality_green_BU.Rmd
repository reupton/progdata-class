---
title: "Prog Data Lab 4"
author: "Becky Upton"
output: html_document
---
```{r load packages}
library(tidyverse)
```

```{r data}
dictionary <- readr::read_csv(here::here("data", "green_dictionary.csv"))
green_data <- readr::read_csv(here::here("data", "green_data.csv"))

glimpse(dictionary)
glimpse(green_data)
```

## 1. Inspect the item responses (e.g., with graphs or by summarizing distinct values). Is anything unusual?

```{r inspect}
green_data |>
  select(-id) |>
  unlist() |>
  unique()

green_data <- green_data |>
  mutate(
  across(
    -id,
    \(x) recode(x, "1" = 1, "2" = 2, "3" = 3, "4" = 4, "5" = 5, "-99" = NA_real_)
  ))

green_data <- green_data |>
  mutate(
  across(
    -id,
    \(x) na_if(x, -99)))
## inspected data, found weird value of -99, assigned to NA
```

## 2. Compute total scores for the four scales. Recode variables as needed.

```{r recode reverse scores}
## find reverse coded items
## pull takes out items as vector and not in a data frame, select makes items you are secting into a data frame

reversed <- dictionary |>
  filter(Keying == -1) |>
  pull(Item) ## assign reversed to an object for simpler recoding below

green_data <- green_data |>
  mutate(green2 = recode(green2, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         comp6 = recode(comp6, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         comp7 = recode(comp7, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         comp8 = recode(comp8, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         comp9 = recode(comp9, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         comp10 = recode(comp10, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         intel7 = recode(intel7, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         intel8 = recode(intel8, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         intel9 = recode(intel9, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         intel10 = recode(intel10, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         open7 = recode(open7, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         open8 = recode(open8, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         open9 = recode(open9, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1),
         open10 = recode(open10, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1))

## can also do recode(green2 = 6 - green2)
## can also do green 2 = max(green2) - green2 + min(green2)

## simpler way so don't have to do it to each column individually

green_data <- green_data |>
  mutate(
    across(
      all_of(reversed),
      \(x) recode(x, "1" = 5, "2" = 4, "3" = 3, "4" = 2, "5" = 1))
    )
  
```

```{r summarize}
green_data <- green_data |>
  rowwise() |>
  mutate(
    .id = id,
    green_total = mean(c_across(green1:green5), na.rm = TRUE),
    comp_total = mean(c_across(comp1:comp10), na.rm = TRUE),
    intel_total = mean(c_across(intel1:intel10), na.rm = TRUE),
    open_total = mean(c_across(open1:open10), na.rm = TRUE),
    .before = everything()
  ) |>
  ungroup() ## puts data grouping as a whole, instead of still keeping each row separate from rowwise() function

## rowwise() makes each row its own group for computations
```

## 3. Rescale the variables so that they go from 0-100 instead of the original range. Name the recaled variables *_pomp.

```{r rescale}
green_data <- green_data |>
  mutate(
    across(
    green_total:open_total,
    \(x) 100 * (x -1) / (5 - 1),
    .names = "{.col}_pomp" ## renaming columns
    )
  )

## can also use datawizard::change_scale(x, range = c(1, 5), to = c(0, 100)) instead of math calculation 100 *....

## green_data <- green_data |>
##  mutate(
##    across(
##    green_total:open_total,
##    \(x) datawizard::change_scale(x, range = c(1, 5), to = c(0, 100)),
##    .names = "{.col}_pomp" ## renaming columns
##    )
##  )

## changing data into what percent of maximum points possible the individual received, because score didn't start at 0 had to subtract 1 from numerator and denominator, standardizing variables/total score 
```

## 4. Make plots that illustrate the distributions of the 4 POMP-scored variables.

```{r pomp plots}
ggplot(green_data) +
  aes(x = green_total_pomp) +
  geom_histogram()

ggplot(green_data) +
  aes(x = comp_total_pomp) +
  geom_histogram()

ggplot(green_data) +
  aes(x = intel_total_pomp) +
  geom_histogram()

ggplot(green_data) +
  aes(x = open_total_pomp) +
  geom_histogram()
```
## 5. Make scatterplots showing the relationships between green reputation and each personality trait. Include trend lines for students and non-students. What do these plots show?

```{r, green and personality}
green_data |>
  filter(!is.na(student)) |>
  ggplot() +
  aes(x = open_total_pomp, y = green_total_pomp, color = factor(student)) +
  geom_point() +
  geom_smooth(method = "lm") ## "lm" makes it straight instead of curvy lines

## is.na() pulls values that are NA/missing
```

## 6. Compare green reputation for students and non-students using a rainfall plot (bar + density + data points).

```{r, compare green rep}
green_data <- green_data |>
  mutate(green_data, Student = factor(student, levels = c("1", "2"), labels = c("no", "yes")))
green_data |> 
  filter(!is.na(Student)) |>
  ggplot() +
  aes(x = green_total_pomp,
      y = Student,
      color = Student, fill = Student) +
  geom_jitter(height = .15) +
  geom_boxplot(color = "black",
               alpha = .5,
               width = .1,
               size = .5) +
  ggdist::stat_slab(height = .3,
                    color = "black",
                    size = .2,
                    alpha = .5,
                    position = position_nudge(y = .2))
```

## 7. Compute a summary table of means, SDs, medians, minima, and maxima for the four total scores for students and non-students.

```{r, Q8a}
green_data |>
  group_by(Student) |>
  summarize(across(green_total_pomp:open_total_pomp,
            mu = mean(),
            sigma = sd(),
            median = median(), 
            min = min(), 
            max = max()))
```